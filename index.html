<!DOCTYPE html>
<html lang="en">

<head>
    <title>Agents Copilot Integration Sample</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">

    <!-- Agents SDK через unpkg CDN (або встановіть через npm і підключіть власний bundle.js) -->
    <script src="https://unpkg.com/@microsoft/agents-sdk@0.0.4/dist/agents-sdk.umd.js"></script>
    <!-- BotFramework WebChat -->
    <script src="https://cdn.botframework.com/botframework-webchat/latest/webchat.js"></script>

    <style>
        html, body {
            height: 100%;
        }
        body {
            margin: 0;
            font-family: "Segoe UI", "Segoe UI Web (West European)", "Segoe UI", -apple-system, BlinkMacSystemFont, Roboto, "Helvetica Neue", sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        #header { background: #0b556a; color: #fff; height: 48px; padding: 0 13px; display: flex; align-items: center; }
        #webchat {
            position: absolute;
            left: 0; right: 30%; top: 48px; bottom: 0;
            width: 70%; height: calc(100% - 48px);
            background: #fff;
            overflow: hidden;
        }
        #agent-container {
            position: absolute;
            right: 0; top: 48px; width: 30%; height: calc(100% - 48px);
            background: #f1f2fa;
            border-left: 1px solid #ddd;
            box-sizing: border-box;
            overflow: auto;
        }
        @media(max-width: 900px){
            #webchat { width: 100%; right: 0; }
            #agent-container { display: none; }
        }
    </style>
</head>

<body>
    <div id="header">Copilot Studio Agents Demo (WebChat + AgentSDK)</div>
    <div id="webchat"></div>
    <div id="agent-container"></div>

    <script>
        // === Render Copilot Studio Chatbot ===
        // Використовується стандартний WebChat підключення
        const directLineEndpoint = "https://aa9a827baedfee7db575bfb7ebdcf7.17.environment.api.powerplatform.com/copilotstudio/dataverse-backed/authenticated/bots/cr7d7_undefinedNameOfTouristInformationAgen/conversations?api-version=2022-03-01-preview";
        async function fetchJSON(url, options = {}) {
            const res = await fetch(url, {
                ...options,
                headers: { ...(options.headers || {}), accept: 'application/json' }
            });
            if (!res.ok) throw new Error(`Failed to fetch JSON: ${res.status}`);
            return await res.json();
        }
        (async () => {
            // 1. Отримайте token
            const { token } = await fetchJSON(directLineEndpoint);
            // 2. Відмальовуйте WebChat
            window.WebChat.renderWebChat({
                directLine: window.WebChat.createDirectLine({ token }),
                userID: 'user_' + Math.random().toString(36).slice(2),
                styleOptions: {
                    botAvatarInitials: 'Bot',
                    userAvatarInitials: 'You'
                }
            }, document.getElementById('webchat'));
        })();
    </script>

    <script>
        // === AGENTS SDK example: Рендер панель агента у <div id="agent-container"> ===
        // Docs: https://learn.microsoft.com/en-us/microsoft-365/agents-sdk/create-test-basic-agent?tabs=javascript

        // Демо-реалізація базового агента
        const { createAgent, React, ReactDOM } = window.AgentsSdk;

        // Стандартний React компонент для агента
        function MyAgentComponent() {
            const [messages, setMessages] = React.useState([]);
            const [value, setValue] = React.useState("");

            // Може сюди під'єднати свою логіку
            function sendMessage() {
                setMessages([...messages, {from: 'user', text: value}]);
                setValue("");
                // Тут можна розширити: відправити це ж запитання в чат-бот через ваш бекенд.
            }
            return (
                React.createElement("div", {style:{padding: 16}},
                    React.createElement("h3", null, "Як можу допомогти? (AGENT SDK DEMO)"),
                    messages.map((msg, idx) => 
                        React.createElement("div", {key: idx, style:{margin:"8px 0"}},
                            React.createElement("b", null, msg.from + ":"), " " + msg.text
                        )
                    ),
                    React.createElement("input", {
                        type:"text",
                        value: value,
                        onChange: e => setValue(e.target.value),
                        style: {width: "85%"}
                    }),
                    React.createElement("button", {onClick: sendMessage, style:{marginLeft:8}},"Відправити")
                )
            )
        }

        // Ініціалізація агента
        const agent = createAgent({
            root: document.getElementById("agent-container"),
            render: root => {
                ReactDOM.render(React.createElement(MyAgentComponent), root);
            }
        });

        // У PRODUCTION: інтегруйте тут зв'язок між WebChat & Agent SDK через скрипти чи REST API вашого сервісу

    </script>
</body>
</html>
