<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Travel Support</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background-image: url('https://images.pexels.com/photos/20409358/pexels-photo-20409358.jpeg');
      background-size: cover;
      background-position: center;
      color: #fff;
    }
    .overlay {
      background: rgba(0, 0, 0, 0.6);
      width: 100%;
      height: 100vh;
      padding: 40px;
      box-sizing: border-box;
      position: relative;
    }
    .lang-switch {
      position: absolute;
      top: 20px;
      right: 20px;
    }
    .lang-switch button {
      margin-left: 10px;
      padding: 5px 10px;
      background: transparent;
      color: #fff;
      border: 1px solid #fff;
      cursor: pointer;
    }
    .lang-switch .active {
      font-weight: bold;
      text-decoration: underline;
      background-color: #fff;
      color: #000;
    }
    .container {
      max-width: 600px;
      text-align: left;
    }
    h1 {
      font-size: 2.5em;
    }
    select, button {
      margin-top: 20px;
      padding: 10px;
      font-size: 1em;
    }
    #loginBtn {
      background-color: #0078D4;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    #userStatus {
      margin-top: 10px;
      font-size: 0.9em;
      color: lightgreen;
    }
  </style>
  <script src="https://alcdn.msauth.net/browser/2.28.1/js/msal-browser.min.js"></script>
</head>
<body onload="initializeApp()">
<div class="overlay">
  <div class="lang-switch">
    <span id="langDisplay">Lang:</span>
    <button id="btn-en" onclick="setLanguage('en')">English</button>
    <button id="btn-fr" onclick="setLanguage('fr')">Français</button>
  </div>
  <div class="container">
    <h1 id="header-text"></h1>
    <p id="desc-text"></p>

    <label for="brand">Brand:</label>
    <select id="brand" onchange="onStateChange()">
      <option value="UP">UP</option>
      <option value="GO">GO</option>
    </select>

    <br>
    <button id="loginBtn" onclick="signIn()">Log In with Microsoft</button>
    <div id="userStatus"></div>
  </div>
</div>

<script>
  let currentLang = 'en';
  let account = null;
  let userName = '';
  let userId = '';
  const theURL = "https://aa9a827baedfee7db575bfb7ebdcf7.17.environment.api.powerplatform.com/copilotstudio/dataverse-backed/authenticated/bots/cr7d7_agentMXBot/conversations?api-version=2022-03-01-preview";

  var clientApplication;
  (function () {
    var msalConfig = {
      auth: {
        clientId: '20432056-2b97-43ca-9cfc-ec900428bbd4',
        authority: 'https://login.microsoftonline.com/d06629ae-56db-44af-880b-80afafa24182'
      }
    };
    clientApplication = new msal.PublicClientApplication(msalConfig);
  })();

  async function signIn() {
    try {
      const loginResponse = await clientApplication.loginPopup({ scopes: ["user.read"] });
      account = loginResponse.account;
      userName = account.name;
      userId = account.accountIdentifier != null ? ("My-custom-prefix" + account.accountIdentifier).substr(0, 64) : (Math.random().toString() + Date.now().toString()).substr(0, 64);
      document.getElementById('loginBtn').disabled = true;
      document.getElementById('userStatus').textContent = `${userName} signed in.`;
      closeChatIfOpen();
    } catch (err) {
      console.error(err);
    }
  }

  function setLanguage(lang) {
    currentLang = lang;
    document.documentElement.lang = lang;

    document.getElementById('btn-en').classList.remove('active');
    document.getElementById('btn-fr').classList.remove('active');
    document.getElementById('btn-' + lang).classList.add('active');

    if (lang === 'en') {
      document.getElementById('header-text').textContent = 'We help you on any journey';
      document.getElementById('desc-text').textContent = 'No matter how you travel — by train, bus or air — you can always count on us for seamless support.';
      document.getElementById('loginBtn').textContent = 'Log In with Microsoft';
    } else {
      document.getElementById('header-text').textContent = 'Nous vous accompagnons dans chaque voyage';
      document.getElementById('desc-text').textContent = 'Quel que soit votre moyen de transport — train, autobus ou avion — vous pouvez compter sur notre soutien sans faille.';
      document.getElementById('loginBtn').textContent = 'Connexion avec Microsoft';
    }
    closeChatIfOpen();
  }

  function onStateChange() {
    closeChatIfOpen();
  }

  function closeChatIfOpen() {
    if (window.Microsoft && Microsoft.Omnichannel.LiveChatWidget && Microsoft.Omnichannel.LiveChatWidget.SDK) {
      Microsoft.Omnichannel.LiveChatWidget.SDK.closeChat();
    }
  }

  function initializeApp() {
    setLanguage(currentLang);
  }
</script>

<script>
  window.addEventListener("lcw:ready", function () {
    const brand = document.getElementById('brand').value;
    const langLabel = currentLang === 'fr' ? 'French' : 'English';
    const context = {
      'UserLanguage': { 'value': langLabel, 'isDisplayable': true },
      'Brand': { 'value': brand, 'isDisplayable': true }
    };
    if (account) {
      context['UserName'] = { 'value': userName, 'isDisplayable': true };
      context['Token'] = { 'value': userId, 'isDisplayable': true };
    }
    Microsoft.Omnichannel.LiveChatWidget.SDK.startChat({
      inNewWindow: false,
      customContext: context
    });
  });
</script>

<!-- Chat Script (unchanged) -->
<script>
  function lcw() {
    return {
      styleProps: {
        generalStyles: { width: "360px", height: "560px", bottom: "20px", right: "20px" }
      },
      headerProps: {
        styleProps: {
          generalStyleProps: { background: "#399e46" },
          titleStyleProps: { color: "#FFFFFF" },
          minimizeButtonStyleProps: { color: "#FFFFFF" },
          closeButtonStyleProps: { color: "#FFFFFF" }
        },
        controlProps: {
          headerTitleProps: { text: currentLang === 'fr' ? "Assistant virtuel" : "Virtual Assistant" },
          hideIcon: false,
          hideTitle: false,
          headerIconProps: {
            src: "https://www.svgrepo.com/show/474732/assistant.svg",
            alt: "Discutons"
          }
        }
      },
      loadingPaneProps: {
        styleProps: {
          generalStyleProps: { background: "#399e46" }
        },
        controlProps: {
          titleText: currentLang === 'fr' ? "Bienvenue au" : "Welcome to",
          subtitleText: currentLang === 'fr' ? "Soutien par clavardage en direct!" : "Live Chat Support!",
          spinnerText: currentLang === 'fr' ? "Chargement…" : "Loading…",
          hideSpinnerText: false,
          spinnerSize: 3
        }
      },
      chatButtonProps: {
        controlProps: {
          hideChatTextContainer: false,
          hideChatSubtitle: true,
          titleText: currentLang === 'fr' ? "Clavarder" : "Chat"
        }
      },
      confirmationPaneProps: {
        controlProps: {
          titleText: currentLang === 'fr' ? "Êtes-vous certain de vouloir quitter la séance de clavardage?" : "Are you sure you want to exit the chat?",
          subtitleText: currentLang === 'fr' ? "Note: Cela mettra fin à la conversation et vous perdrez votre historique de clavardage." : "Note: This will end your conversation, and you will lose your chat history.",
          brightnessValueOnDim: "0.2",
          confirmButtonText: currentLang === 'fr' ? "Oui" : "Yes",
          cancelButtonText: currentLang === 'fr' ? "Non" : "No"
        }
      }
    };
  }
</script>
<script id="Microsoft_Omnichannel_LCWidget"
        src="https://oc-cdn-ocprod.azureedge.net/livechatwidget/scripts/LiveChatBootstrapper.js"
        data-app-id="d9f84d07-eecf-4bac-8385-084026ce5750" data-lcw-version="prod"
        data-org-id="44e3fe33-032f-f011-9a43-002248282d3c"
        data-org-url="https://m-44e3fe33-032f-f011-9a43-002248282d3c.us.omnichannelengagementhub.com"
        data-font-family-override="Monotype Corsiva" data-color-override="#0000FF" data-customization-callback="lcw">
</script>
</body>
</html>
