<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>SSO with Entra ID</title>
    <script src="https://alcdn.msauth.net/browser/2.37.0/js/msal-browser.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>SSO with Entra ID</h1>
    <button id="loginButton">Login with Microsoft</button>
    <div id="status"></div>
    <pre id="token" class="hidden"></pre>
    <script>
        // TODO: Replace the below values with your client and tenant IDs and token endpoint
        const msalConfig = {
            auth: {
                clientId: "20432056-2b97-43ca-9cfc-ec900428bbd4", // <-- Your Client ID
                authority: "https://login.microsoftonline.com/d06629ae-56db-44af-880b-80afafa24182", // <-- Your Tenant ID
                redirectUri: window.location.href
            }
        };

        // Microsoft Graph scopes or your API scopes
        const loginRequest = {
            scopes: [ "openid", "profile", "email", "offline_access" ]
        };

        // Your Token Endpoint (where you will use the token)
        const tokenEndpoint = "https://aa9a827baedfee7db575bfb7ebdcf7.17.environment.api.powerplatform.com/copilotstudio/dataverse-backed/authenticated/bots/cr7d7_undefinedNameOfTouristInformationAgen/conversations?api-version=2022-03-01-preview";

        const msalInstance = new msal.PublicClientApplication(msalConfig);

        const loginButton = document.getElementById('loginButton');
        const statusDiv = document.getElementById('status');
        const tokenPre = document.getElementById('token');

        loginButton.onclick = async function() {
            statusDiv.innerText = "Logging in...";
            try {
                const loginResponse = await msalInstance.loginPopup(loginRequest);
                statusDiv.innerText = "Login successful!\nGetting access token...";
                
                // Now get token silently, fallback to popup if needed
                const account = msalInstance.getAllAccounts()[0];
                const tokenResponse = await msalInstance.acquireTokenSilent({
                    ...loginRequest,
                    account
                }).catch(async (error) => {
                    // Fallback to popup
                    return msalInstance.acquireTokenPopup(loginRequest);
                });

                statusDiv.innerText = "Access token acquired!\nCalling token endpoint...";

                tokenPre.classList.remove("hidden");
                tokenPre.innerText = JSON.stringify(tokenResponse, null, 4);

                // Example: call your token endpoint with the token
                // (You can customize the fetch request as needed)
                const response = await fetch(tokenEndpoint, {
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${tokenResponse.accessToken}`,
                        "Accept": "application/json"
                    }
                });
                const data = await response.json();
                statusDiv.innerText = "Token endpoint call result (see console for details):";
                console.log("Token endpoint response:", data);

            } catch (err) {
                statusDiv.innerText = "Error: " + (err.errorMessage || err.message || err.toString());
                console.error(err);
            }
        };
    </script>
</body>
</html>
