<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Travel Helper</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      background: url('https://images.pexels.com/photos/20409358/pexels-photo-20409358.jpeg?_gl=1*1y7tkqd*_ga*MTMxOTQ0MzI2MC4xNzUwMzI3OTQx*_ga_8JE65Q40S6*czE3NTEzNTU4MTgkbzMkZzEkdDE3NTEzNTU4NTUkajIzJGwwJGgw') no-repeat center center fixed;
      background-size: cover;
      margin:0; min-height:100vh;
    }
    .main-content {
      background: rgba(255,255,255,0.96);
      max-width: 490px;
      border-radius: 16px;
      margin: 48px 0 0 48px;
      padding: 44px 36px 36px 32px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      box-shadow: 0 4px 16px rgba(0,0,0,.13);
      min-height: 350px;
      gap: 28px;
    }
    .lang-bar {
      position: absolute;
      right: 40px;
      top: 24px;
      display: flex;
      gap: 10px;
      z-index: 10;
    }
    .lang-btn {
      background: #fff;
      border: 2px solid #179c3f;
      color: #179c3f;
      font-weight: 700;
      border-radius: 20px;
      padding: 5px 22px 5px 22px;
      font-size: 1.07em;
      transition: background .2s, color .2s;
      cursor:pointer;
      outline:none;
    }
    .lang-btn.selected, .lang-btn:hover {
      background: #179c3f;
      color: #fff;
    }
    #login-area {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    #ms-login-btn, #logout-btn {
      background: #005abb;
      color: #fff;
      font-weight: 600;
      border: none;
      padding: 8px 18px;
      border-radius: 16px;
      font-size: 1em;
      cursor: pointer;
      margin-right: 10px;
    }
    #logout-btn { background: #c82333; margin-right: 0; }
    #login-msg {
      color: #179c3f;
      font-weight: 700;
      font-size: 1em;
    }
    h1 {
      color: #179c3f;
      font-size: 2.08em;
      margin-bottom: 4px;
      margin-top: 4px;
      font-weight: 800;
      letter-spacing: -.03em;
    }
    #desc {
      font-size: 1.15em;
      color: #222;
      margin-bottom: 10px;
      margin-top: 6px;
    }
    #brand-select-label {
      font-weight: 600;
      font-size: 1.07em;
      margin-right: 8px;
      margin-bottom: 18px!important;
    }
    #brand-select {
      font-size: 1em;
      padding: 7.5px 24px 7.5px 12px;
      border: 2px solid #179c3f;
      border-radius: 7px;
      margin-top: 7px;
      color: #222;
      min-width: 90px;
    }
    @media (max-width:750px) {
      .main-content { margin: 22px 0 0 0; padding: 26px 10px;}
      .lang-bar { right: 4vw; top: 8px;}
    }
  </style>
</head>
<body>
  <div class="lang-bar">
    <button class="lang-btn selected" id="lang-en">EN</button>
    <button class="lang-btn" id="lang-fr">FR</button>
  </div>
  <div class="main-content">
    <div id="login-area">
      <button id="ms-login-btn"></button>
      <span id="login-msg"></span>
      <button id="logout-btn" style="display:none"></button>
    </div>
    <h1 id="main-title"></h1>
    <div id="desc"></div>
    <label id="brand-select-label" for="brand-select"></label>
    <select id="brand-select">
      <option value="UP">UP</option>
      <option value="GO">GO</option>
    </select>
  </div>

  <!-- MSAL.js for Microsoft Login -->
  <script src="https://alcdn.msauth.net/browser/2.39.0/js/msal-browser.min.js"></script>

  <script>
  // Мови
  const translations = {
    en: {
      title: "We support your journeys everywhere",
      desc: "No matter how you choose to travel, you can always rely on us for support and assistance. Focus on your experience, and let us handle the rest!",
      brand: "Brand:",
      login: "Sign in with Microsoft",
      logout: "Sign out",
      greeting: "Welcome, {username}! You are now signed in.",
    },
    fr: {
      title: "Nous vous accompagnons lors de tous vos voyages",
      desc: "Peu importe votre moyen de transport, vous pouvez toujours compter sur notre assistance et notre soutien. Profitez de votre voyage, nous nous occupons du reste !",
      brand: "Marque :",
      login: "Se connecter avec Microsoft",
      logout: "Déconnexion",
      greeting: "Bienvenue, {username} ! Vous êtes maintenant connecté.",
    }
  };
  // Мова за замовчуванням — англійська
  let currentLang = localStorage.getItem('lang') || 'en';
  let userProfile = null;
  let accessToken = null, msalInstance = null;

  function applyTranslations() {
    document.getElementById('main-title').textContent = translations[currentLang].title;
    document.getElementById('desc').textContent = translations[currentLang].desc;
    document.getElementById('brand-select-label').textContent = translations[currentLang].brand;
    document.getElementById('ms-login-btn').textContent = translations[currentLang].login;
    document.getElementById('logout-btn').textContent = translations[currentLang].logout;
    if (userProfile) {
      document.getElementById('login-msg').textContent = translations[currentLang].greeting.replace("{username}", userProfile.name);
    } else {
      document.getElementById('login-msg').textContent = '';
    }
  }
  document.getElementById('lang-en').onclick = function() {
    currentLang = 'en'; localStorage.setItem('lang', 'en');
    document.getElementById('lang-en').classList.add('selected');
    document.getElementById('lang-fr').classList.remove('selected');
    applyTranslations();
  };
  document.getElementById('lang-fr').onclick = function() {
    currentLang = 'fr'; localStorage.setItem('lang', 'fr');
    document.getElementById('lang-fr').classList.add('selected');
    document.getElementById('lang-en').classList.remove('selected');
    applyTranslations();
  };

  // ---- MSAL login ----
  const msalConfig = {
    auth: {
      clientId: '20432056-2b97-43ca-9cfc-ec900428bbd4',
      authority: "https://login.microsoftonline.com/d06629ae-56db-44af-880b-80afafa24182",
      redirectUri: window.location.origin + window.location.pathname,
    }
  };
  msalInstance = new msal.PublicClientApplication(msalConfig);

  async function msLogin() {
    try {
      const loginResp = await msalInstance.loginPopup({
        scopes: [ "User.Read" ],
        prompt: "select_account"
      });
      const tokenResp = await msalInstance.acquireTokenSilent({scopes: ["User.Read"], account: loginResp.account});
      accessToken = tokenResp.accessToken;
      const prof = await fetch("https://graph.microsoft.com/v1.0/me", {
        headers: { 'Authorization': 'Bearer ' + accessToken }
      }).then(r=>r.json());
      userProfile = {
        id: prof.id,
        name: prof.displayName,
        raw: prof
      };
      showLoginGreeting();
    } catch (e) {
      alert("Login failed: "+ (e.errorMessage || e.message));
    }
  }
  document.getElementById('ms-login-btn').onclick = msLogin;
  function showLoginGreeting() {
    document.getElementById('login-msg').textContent =
      translations[currentLang].greeting.replace("{username}", userProfile.name);
    document.getElementById('ms-login-btn').style.display = "none";
    document.getElementById('logout-btn').style.display = "";
  }
  document.getElementById('logout-btn').onclick = function() {
    msalInstance.logoutPopup().then(() => {
      userProfile = null; accessToken = null;
      document.getElementById('ms-login-btn').style.display = "";
      document.getElementById('logout-btn').style.display = "none";
      document.getElementById('login-msg').textContent = "";
    });
  };

  window.onload = applyTranslations;

  // --- Заглушка для auth.getAuthenticationToken ---
  window.auth = window.auth || {};
  window.auth.getAuthenticationToken = function(callback) {
      if (!window.userProfile) {
          // Не залогінений — гостей пускаємо без токена (виджет не отримає JWT)
          callback(null);
          return;
      }
      // Залогінений користувач — тут можуть бути твоя справжня генерація JWT
      // Для тесту:
      callback("DUMMY_TOKEN_" + (window.userProfile.id || Date.now()));
  };
  </script>

  <!-- Твій чат-скрипт (без змін!) -->
  <script>
      function lcw() {
          let localized_texts = {
              webchatTitle: "Virtual Assistant",
              webchatChatButton: "Chat",
              webchatAlertTitle: "Are you sure you want to exit the chat?",
              webchatAlertMessage: "Note: This will end your conversation, and you will lose your chat history.",
              webchatNoButton: "No",
              webchatYesButton: "Yes",
              webchatLoadingPaneTitle: "Welcome to",
              webchatLoadingPaneSubTitle: "Live Chat Support!",
              webchatLoadingPaneSpinnerText: "Loading\u2026",
          }
          if (true) {
              localized_texts.webchatTitle = "Assistant virtuel";
              localized_texts.webchatChatButton = "Clavarder";
              localized_texts.webchatAlertTitle = "\u00CAtes-vous certain de vouloir quitter la s\u00E9ance de clavardage?";
              localized_texts.webchatAlertMessage = "Note\u202F: Cela mettra fin \u00E0 la conversation et vous perdrez votre historique de clavardage.";
              localized_texts.webchatNoButton = "Non";
              localized_texts.webchatYesButton = "Oui";
              localized_texts.webchatLoadingPaneTitle = "Bienvenue au";
              localized_texts.webchatLoadingPaneSubTitle = "Soutien par clavardage en direct!";
              localized_texts.webchatLoadingPaneSpinnerText = "Chargement\u2026";
          }

          return {
              styleProps: {
                  generalStyles: {
                      width: "360px",
                      height: "560px",
                      bottom: "20px",
                      right: "20px"
                  }
              },
              headerProps: {
                  styleProps: {
                      generalStyleProps: {
                          background: "#399e46"
                      },
                      titleStyleProps: {
                          color: "#FFFFFF"
                      },
                      minimizeButtonStyleProps: {
                          color: "#FFFFFF"
                      },
                      closeButtonStyleProps: {
                          color: "#FFFFFF"
                      }
                  },
                  controlProps: {
                      headerTitleProps: {
                          text: localized_texts.webchatTitle
                      },
                      hideIcon: false,
                      hideTitle: false,
                      headerIconProps: {
                          src: "https://www.svgrepo.com/show/474732/assistant.svg",
                          alt: "Discutons"
                      }
                  }
              },
              loadingPaneProps: {
                  styleProps: {
                      generalStyleProps: {
                          background: "#399e46"
                      }
                  },
                  controlProps: {
                      titleText: localized_texts.webchatLoadingPaneTitle,
                      subtitleText: localized_texts.webchatLoadingPaneSubTitle,
                      spinnerText: localized_texts.webchatLoadingPaneSpinnerText,
                      hideSpinnerText: false,
                      spinnerSize: 3,
                  }
              },
              chatButtonProps: {
                  controlProps: {
                      hideChatTextContainer: false,
                      hideChatSubtitle: true,
                      titleText: localized_texts.webchatChatButton,
                  }
              },
              confirmationPaneProps: {
                  controlProps: {
                      titleText: localized_texts.webchatAlertTitle,
                      subtitleText: localized_texts.webchatAlertMessage,
                      brightnessValueOnDim: "0.2",
                      confirmButtonText: localized_texts.webchatYesButton,
                      cancelButtonText: localized_texts.webchatNoButton,
                  }
              }
          };
      }
  </script>

  <script id="Microsoft_Omnichannel_LCWidget"
      src="https://oc-cdn-ocprod.azureedge.net/livechatwidget/scripts/LiveChatBootstrapper.js"
      data-app-id="d9f84d07-eecf-4bac-8385-084026ce5750" data-lcw-version="prod"
      data-org-id="44e3fe33-032f-f011-9a43-002248282d3c"
      data-org-url="https://m-44e3fe33-032f-f011-9a43-002248282d3c.us.omnichannelengagementhub.com"
      data-font-family-override="Monotype Corsiva" data-color-override="#0000FF" data-customization-callback="lcw">
  </script>
  <script>
      window.addEventListener("lcw:ready", function () {
          Microsoft.Omnichannel.LiveChatWidget.SDK.startChat({
              inNewWindow: false,
              customContext: {
                  'UserLanguage': { 'value': 'lang', 'isDisplayable': true },
                  'Brand': { 'value': 'brand', 'isDisplayable': true },
                  'UserName': { 'value': 'name', 'isDisplayable': true },
                  'Token': { 'value': 'id', 'isDisplayable': true }
              }
          });
      });
  </script>
</body>
</html>
