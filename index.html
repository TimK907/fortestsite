<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Travel Helper</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      background: url('https://images.pexels.com/photos/20409358/pexels-photo-20409358.jpeg?_gl=1*1y7tkqd*_ga*MTMxOTQ0MzI2MC4xNzUwMzI3OTQx*_ga_8JE65Q40S6*czE3NTEzNTU4MTgkbzMkZzEkdDE3NTEzNTU4NTUkajIzJGwwJGgw') no-repeat center center fixed;
      background-size: cover;
      margin:0; min-height:100vh;
    }
    .main-content {
      background: rgba(255,255,255,0.96);
      max-width: 490px;
      border-radius: 16px;
      margin: 48px 0 0 48px;
      padding: 44px 36px 36px 32px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      box-shadow: 0 4px 16px rgba(0,0,0,.13);
      min-height: 350px;
      gap: 28px;
    }
    .lang-bar {
      position: absolute;
      right: 40px;
      top: 24px;
      display: flex;
      gap: 10px;
      z-index: 10;
    }
    .lang-btn {
      background: #fff;
      border: 2px solid #179c3f;
      color: #179c3f;
      font-weight: 700;
      border-radius: 20px;
      padding: 5px 22px 5px 22px;
      font-size: 1.07em;
      transition: background .2s, color .2s;
      cursor:pointer;
      outline:none;
    }
    .lang-btn.selected, .lang-btn:hover {
      background: #179c3f;
      color: #fff;
    }
    #login-area {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    #login-form, #create-form {
      display: flex;
      gap: 8px;
      flex-direction: row;
      align-items: center;
      margin-bottom: 10px;
    }
    #login-form input, #create-form input {
      padding: 5px 14px;
      border: 1.5px solid #aaa;
      font-size: 1em;
      border-radius: 7px;
    }
    #login-form button, #create-form button {
      padding: 5px 14px;
      border-radius: 11px;
      border: none;
      color: #fff;
      background-color: #1c7fbd;
      font-weight: 700;
      font-size: 1em;
      cursor: pointer;
      margin-left: 8px;
    }
    #create-link, #go-login-link {
      color: #179c3f;
      text-decoration: underline;
      background: none; border: none; cursor: pointer;
      margin: 0 0 0 12px;
      font-size: 0.98em;
    }
    #logout-btn {
      background: #c82333;
      color: #fff;
      border: none;
      border-radius: 16px;
      padding: 7px 20px;
      cursor: pointer;
      font-size: 1em;
      font-weight: 600;
    }
    #login-msg {
      color: #179c3f;
      font-weight: 700;
      font-size: 1em;
      margin-left: 0;
      margin-right: 0;
    }
    h1 {
      color: #179c3f;
      font-size: 2.08em;
      margin-bottom: 4px;
      margin-top: 4px;
      font-weight: 800;
      letter-spacing: -.03em;
    }
    #desc {
      font-size: 1.15em;
      color: #222;
      margin-bottom: 10px;
      margin-top: 6px;
    }
    #brand-select-label {
      font-weight: 600;
      font-size: 1.07em;
      margin-right: 8px;
      margin-bottom: 18px!important;
    }
    #brand-select {
      font-size: 1em;
      padding: 7.5px 24px 7.5px 12px;
      border: 2px solid #179c3f;
      border-radius: 7px;
      margin-top: 7px;
      color: #222;
      min-width: 90px;
    }
    @media (max-width:750px) {
      .main-content { margin: 22px 0 0 0; padding: 26px 10px;}
      .lang-bar { right: 4vw; top: 8px;}
    }
  </style>
</head>
<body>
  <div class="lang-bar">
    <button class="lang-btn selected" id="lang-en">EN</button>
    <button class="lang-btn" id="lang-fr">FR</button>
  </div>
  <div class="main-content">
    <div id="login-area"></div>
    <h1 id="main-title"></h1>
    <div id="desc"></div>
    <label id="brand-select-label" for="brand-select"></label>
    <select id="brand-select">
      <option value="UP">UP</option>
      <option value="GO">GO</option>
    </select>
  </div>

  <script>
  // ========= Мова та переклади =========
  const translations = {
    en: {
      title: "We support your journeys everywhere",
      desc: "No matter how you choose to travel, you can always rely on us for support and assistance. Focus on your experience, and let us handle the rest!",
      brand: "Brand:",
      hello: "Welcome, {username}! You are now signed in.",
      login: "Sign in",
      logout: "Sign out",
      userToken: "User token",
      password: "Password",
      createLink: "Create profile",
      createProfile: "Create profile",
      loginLink: "Back to sign in",
      createName: "User name",
      createSuccess: "Profile created! Now log in.",
      wrong: "Wrong token or password.",
    },
    fr: {
      title: "Nous vous accompagnons lors de tous vos voyages",
      desc: "Peu importe votre moyen de transport, vous pouvez toujours compter sur notre assistance et notre soutien. Profitez de votre voyage, nous nous occupons du reste !",
      brand: "Marque :",
      hello: "Bienvenue, {username} ! Vous êtes maintenant connecté.",
      login: "Se connecter",
      logout: "Déconnexion",
      userToken: "Identifiant",
      password: "Mot de passe",
      createLink: "Créer un profil",
      createProfile: "Créer un profil",
      loginLink: "Retour à la connexion",
      createName: "Nom d’utilisateur",
      createSuccess: "Profil créé ! Veuillez vous connecter.",
      wrong: "Identifiant ou mot de passe incorrect.",
    }
  };
  let currentLang = localStorage.getItem('lang') || 'en';
  let userProfile = null;
  let profiles = JSON.parse(localStorage.getItem('profiles')||'{}'); // token: {name, password}
  function updateUI(){
    // Текстова частина
    document.getElementById('main-title').textContent = translations[currentLang].title;
    document.getElementById('desc').textContent = translations[currentLang].desc;
    document.getElementById('brand-select-label').textContent = translations[currentLang].brand;
    // Авторизація
    const area = document.getElementById("login-area");
    area.innerHTML = ''; // clear
    if(userProfile){
      area.innerHTML = `<span id="login-msg">${translations[currentLang].hello.replace('{username}', userProfile.name)}</span>
        <button id="logout-btn">${translations[currentLang].logout}</button>`;
      document.getElementById('logout-btn').onclick = function(){
        userProfile = null;
        updateUI();
        updateChatVars();
      };
    }else{
      if(window.showCreate){
        // Форма створення профілю (user token, user name, password)
        area.innerHTML = `<form id="create-form" autocomplete="off" onsubmit="return false;">
          <input id="cr-token" required placeholder="${translations[currentLang].userToken}" autocomplete="off" maxlength="32"/>
          <input id="cr-name"  required placeholder="${translations[currentLang].createName}" autocomplete="off" maxlength="32"/>
          <input id="cr-pw"    required type="password" placeholder="${translations[currentLang].password}" maxlength="32"/>
          <button type="submit">${translations[currentLang].createProfile}</button>
          <button id="go-login-link" type="button">${translations[currentLang].loginLink}</button>
        </form>
        <div id="create-msg"></div>`;
        document.getElementById("go-login-link").onclick = function(){ window.showCreate=false; updateUI();};
        document.getElementById("create-form").onsubmit = function(){
          const token = document.getElementById("cr-token").value.trim();
          const name  = document.getElementById("cr-name").value.trim();
          const pw    = document.getElementById("cr-pw").value;
          if(token && name && pw){
            profiles[token]={name:name,password:pw};
            localStorage.setItem('profiles',JSON.stringify(profiles));
            document.getElementById("create-msg").textContent=translations[currentLang].createSuccess;
          }
        };
      }else{
        // Форма входу (token, password) + create profile
        area.innerHTML =
        `<form id="login-form" autocomplete="off" onsubmit="return false;">
          <input id="li-token" required placeholder="${translations[currentLang].userToken}" autocomplete="off" maxlength="32">
          <input id="li-pw" required type="password" placeholder="${translations[currentLang].password}" maxlength="32">
          <button>${translations[currentLang].login}</button>
          <button id="create-link" type="button">${translations[currentLang].createLink}</button>
        </form>
        <div id="login-msg"></div>`;
        document.getElementById("create-link").onclick=function(){window.showCreate=true; updateUI();};
        document.getElementById("login-form").onsubmit = function(){
          const token = document.getElementById("li-token").value.trim();
          const pw    = document.getElementById("li-pw").value;
          if(token && profiles[token] && profiles[token].password===pw){
            userProfile={token:token, name:profiles[token].name};
            updateUI(); 
            setTimeout(updateChatVars,200);
          }else{
            document.getElementById("login-msg").textContent=translations[currentLang].wrong;
          }
        };
      }
    }
  }
  // Переключення мови
  document.getElementById('lang-en').onclick = function() {
    currentLang = 'en'; localStorage.setItem('lang', 'en');
    document.getElementById('lang-en').classList.add('selected');
    document.getElementById('lang-fr').classList.remove('selected');
    window.showCreate=false;
    updateUI();
    updateChatVars();
  };
  document.getElementById('lang-fr').onclick = function() {
    currentLang = 'fr'; localStorage.setItem('lang', 'fr');
    document.getElementById('lang-fr').classList.add('selected');
    document.getElementById('lang-en').classList.remove('selected');
    window.showCreate=false;
    updateUI();
    updateChatVars();
  };
  document.getElementById('brand-select').onchange=updateChatVars;
  // Перша ініціалізація
  window.showCreate=false;
  window.onload = function(){
    if(!localStorage.getItem('lang')){ currentLang='en'; localStorage.setItem('lang','en'); }
    document.getElementById('lang-en').classList.toggle('selected', currentLang==='en');
    document.getElementById('lang-fr').classList.toggle('selected', currentLang==='fr');
    updateUI();
    updateChatVars();
  };
  // ====== CHAT CONTEXT INTEGRATION ======
  function getCurrentBrand(){return document.getElementById('brand-select')?.value || 'UP';}
  function getCurrentLanguage(){
    return currentLang==='en'?"English":"French";
  }
  function getCurrentUser(){
    if (!userProfile) return {};
    return { name: userProfile.name, id: userProfile.token };
  }
  // Оновити чат, якщо мова/бренд/логін змінені
  function updateChatVars(){
    if(window.Microsoft && window.Microsoft.Omnichannel && window.Microsoft.Omnichannel.LiveChatWidget && 
       window.Microsoft.Omnichannel.LiveChatWidget.SDK){
      try{ Microsoft.Omnichannel.LiveChatWidget.SDK.endChat(); }catch(e){}
      setTimeout(startChat, 300);
    }
  }
  // Ініціалізація чату
  function startChat() {
    if (!(window.Microsoft && window.Microsoft.Omnichannel && window.Microsoft.Omnichannel.LiveChatWidget && 
           window.Microsoft.Omnichannel.LiveChatWidget.SDK)) return;
    let ctx = {
      'UserLanguage': { 'value': getCurrentLanguage(), 'isDisplayable': true },
      'Brand': { 'value': getCurrentBrand(), 'isDisplayable': true },
    };
    if (userProfile) {
      ctx.UserName = { value: userProfile.name, isDisplayable: true };
      ctx.Token = { value: userProfile.token, isDisplayable: true };
    }
    Microsoft.Omnichannel.LiveChatWidget.SDK.startChat({
      inNewWindow: false,
      customContext: ctx
    });
  }
  </script>

  <!-- Чат code НЕ змінювався -->
  <script>
      function lcw() {
          let lang = localStorage.getItem('lang') === 'fr' ? "French" : "English";
          const localized_texts = {
            "English": {
              webchatTitle: "Virtual Assistant",
              webchatChatButton: "Chat",
              webchatAlertTitle: "Are you sure you want to exit the chat?",
              webchatAlertMessage: "Note: This will end your conversation, and you will lose your chat history.",
              webchatNoButton: "No",
              webchatYesButton: "Yes",
              webchatLoadingPaneTitle: "Welcome to",
              webchatLoadingPaneSubTitle: "Live Chat Support!",
              webchatLoadingPaneSpinnerText: "Loading\u2026",
            },
            "French": {
              webchatTitle: "Assistant virtuel",
              webchatChatButton: "Clavarder",
              webchatAlertTitle: "\u00CAtes-vous certain de vouloir quitter la s\u00E9ance de clavardage?",
              webchatAlertMessage: "Note\u202F: Cela mettra fin \u00E0 la conversation et vous perdrez votre historique de clavardage.",
              webchatNoButton: "Non",
              webchatYesButton: "Oui",
              webchatLoadingPaneTitle: "Bienvenue au",
              webchatLoadingPaneSubTitle: "Soutien par clavardage en direct!",
              webchatLoadingPaneSpinnerText: "Chargement\u2026",
            }
          }[lang];

          return {
              styleProps: {
                  generalStyles: {
                      width: "360px",
                      height: "560px",
                      bottom: "20px",
                      right: "20px"
                  }
              },
              headerProps: {
                  styleProps: {
                      generalStyleProps: {
                          background: "#399e46"
                      },
                      titleStyleProps: {
                          color: "#FFFFFF"
                      },
                      minimizeButtonStyleProps: {
                          color: "#FFFFFF"
                      },
                      closeButtonStyleProps: {
                          color: "#FFFFFF"
                      }
                  },
                  controlProps: {
                      headerTitleProps: {
                          text: localized_texts.webchatTitle
                      },
                      hideIcon: false,
                      hideTitle: false,
                      headerIconProps: {
                          src: "https://www.svgrepo.com/show/474732/assistant.svg",
                          alt: "Discutons"
                      }
                  }
              },
              loadingPaneProps: {
                  styleProps: {
                      generalStyleProps: {
                          background: "#399e46"
                      }
                  },
                  controlProps: {
                      titleText: localized_texts.webchatLoadingPaneTitle,
                      subtitleText: localized_texts.webchatLoadingPaneSubTitle,
                      spinnerText: localized_texts.webchatLoadingPaneSpinnerText,
                      hideSpinnerText: false,
                      spinnerSize: 3,
                  }
              },
              chatButtonProps: {
                  controlProps: {
                      hideChatTextContainer: false,
                      hideChatSubtitle: true,
                      titleText: localized_texts.webchatChatButton,
                  }
              },
              confirmationPaneProps: {
                  controlProps: {
                      titleText: localized_texts.webchatAlertTitle,
                      subtitleText: localized_texts.webchatAlertMessage,
                      brightnessValueOnDim: "0.2",
                      confirmButtonText: localized_texts.webchatYesButton,
                      cancelButtonText: localized_texts.webchatNoButton,
                  }
              }
          };
      }
  </script>
  <script id="Microsoft_Omnichannel_LCWidget"
      src="https://oc-cdn-ocprod.azureedge.net/livechatwidget/scripts/LiveChatBootstrapper.js"
      data-app-id="d9f84d07-eecf-4bac-8385-084026ce5750" data-lcw-version="prod"
      data-org-id="44e3fe33-032f-f011-9a43-002248282d3c"
      data-org-url="https://m-44e3fe33-032f-f011-9a43-002248282d3c.us.omnichannelengagementhub.com"
      data-font-family-override="Monotype Corsiva" data-color-override="#0000FF" data-customization-callback="lcw">
  </script>
</body>
</html>
